!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.eusiCore=t()}(this,function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},n=function(e,n,r){switch(n){case"$between":case"$in":return function(e,t){if(!Array.isArray(t))throw new Error("value of "+e+" operator must be of Array type")}(n,r),t({},e+"["+n+"]",r.join(","));default:return t({},function(e,t){return e+"["+t+"]"}(e,n),r)}},r=function(r){return function(o){return"object"!==(void 0===o?"undefined":e(o))?t({},r,o):function(e,t){return Object.keys(t).reduce(function(r,o){return Object.assign({},r,n(e,o,t[o]))},{})}(r,o)}},o={model:r("sys.model"),type:r("sys.model"),key:r("sys.key"),title:r("sys.title"),name:r("sys.title"),taxonomyName:r("sys.taxonomy.name"),taxonomyId:r("sys.taxonomy"),taxonomyPath:r("sys.taxonomy.path"),field:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).reduce(function(t,n){var o=e[n],i=r("elem."+n)(o);return Object.assign({},t,i)},{})}},i=function(e){if(!e)throw new Error("access token missing! Maybe you forgot to login or register or \n        for anonymous usage you have to obtain the token by calling getAccess method on eusi client object")},u=function(e){return{Authorization:"Bearer "+e}},a=function(e){var t=e.bucketKey,n=e.httpService,r=e.baseUrl,a=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=a.pageSize,s=void 0===c?20:c,f=a.pageNumber,y=void 0===f?1:f,m=a.token,d=e.key,l=e.title,b=e.taxonomyId,g=e.taxonomyName,v=e.taxonomyPath,p=e.model,h=e.field;i(m);var k,x=(k={key:d,title:l,taxonomyId:b,taxonomyName:g,taxonomyPath:v,model:p,field:h},Object.keys(k).filter(function(e){return!!k[e]}).reduce(function(e,t){var n=k[t],r=o[t];return Object.assign({},e,r(n))},{}));return n.get(r+"/"+t+"/items",{params:Object.assign({},x,{number:s,page:y}),headers:u(m)})},c=function(e,o){var a=o.token;return i(a),n.get(r+"/"+t+"/items/"+e,{headers:u(a)})},s=function(e,t){return a({title:e},t)},f=function(e,t){return a({model:e},t)};return{get:a,getByTaxonomyPath:function(e,t){return a({taxonomyPath:e},t)},getByType:function(e,t){return console.warn("DEPRECATED: method getByType is deprecated and won't be available from the version 2.0.0. Please use getByModel instead"),f(e,t)},getByModel:f,getById:c,getByKey:c,getByTaxonomyId:function(e,t){return a({taxonomyId:e},t)},getByTaxonomyName:function(e,t){return a({taxonomyName:e},t)},getByTitle:s,getByName:function(e,t){return console.warn("DEPRECATED: method getByName is deprecated and won't be available from the version 2.0.0. Please use getByTitle instead"),s(e,t)},getByField:function(e,t){return a({field:e},t)}}},c=function(e){var t=Object.keys(e).map(function(t){return t+"="+e[t]}).reduce(function(e,t){return e?e+"&"+t:t},"");return encodeURI(t)},s=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];i(e);var n=t?{"content-type":"application/x-www-form-urlencoded"}:{};return Object.assign({},u(e),n)},f="https://delivery.eusi.cloud/api/v1";return function(e){var n=e.HttpService,r=e.deliveryApi;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=e.bucketKey,i=e.bucketSecret;!function(e,t){var n=function(e){return e+" data is missing. You can find it under settings section on EUSI web app"};if(!e)throw new Error(n("bucketKey"));if(!t)throw new Error(n("bucketSecret"))}(o,i);var y={bucketKey:o,bucketSecret:i,httpService:n,baseUrl:r||f},m=a(y),d=function(e){var t=e.bucketKey,n=e.bucketSecret,r=e.httpService,o=e.baseUrl,i=function(){return r.post(o+"/"+t+"/authorize",{body:{secret:n}})},a=function(e,t){return i().then(function(n){var o=u(n.token);return r.post(e,{headers:o,body:t})})};return{getAccess:i,login:function(e,n){return a(o+"/"+t+"/login",{email:e,password:n})},register:function(e){var n=e.email,r=e.password,i=e.firstName,u=e.lastName;return a(o+"/"+t+"/register",{email:n,password:r,first_name:i,last_name:u})},getUser:function(e){var n=e.token;return r.get(o+"/"+t+"/me",{headers:u(n)})}}}(y),l=function(e){var t=e.httpService,n=e.bucketKey,r=e.baseUrl;return{getForm:function(e,o){var i=o.token;return t.get(r+"/"+n+"/forms/"+e,{headers:s(i,!1)})},submitForm:function(e,o,i){var u=i.token;return t.post(r+"/"+n+"/forms/"+e,{body:c(o),headers:s(u)})},testSubmitForm:function(e,o,i){var u=i.token;return t.post(r+"/"+n+"/forms/"+e+"/test",{body:c(o),headers:s(u)})}}}(y),b=function(e){var t=e.bucketKey,n=e.baseUrl,r=e.httpService;return{getTaxonomy:function(e,o){var i=o.token;return r.get(n+"/"+t+"/taxonomy/"+e,{headers:u(i)})}}}(y);return Object.assign(function(e){var n=Object.assign({},m,b),r=Object.keys(n).reduce(function(r,o){return Object.assign({},r,t({},o,function(){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n[o](u,Object.assign.apply(Object,[{},{token:e}].concat(r)))}))},{});return Object.assign({},r,function(e,t){return{getForm:function(n){return e.getForm(n,{token:t})},submitForm:function(n,r){return e.submitForm(n,r,{token:t})},testSubmitForm:function(n,r){return e.testSubmitForm(n,r,{token:t})}}}(l,e),function(e,t){return{getUser:function(){return e.getUser({token:t})}}}(d,e))},d,l,m,b)}}});
